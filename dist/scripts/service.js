var url={parse:function(e){var r=document.createElement("a");return r.href=e,r}},scripts=document.getElementsByTagName("script"),path=scripts[scripts.length-1].src.split("?")[0],mydir=path.split("/").slice(0,-1).join("/")+"/",scriptLocation=url.parse(mydir);angular.module("servicesModule").factory("service",["$http","$q",function(n,o){var e={};for(var r in n)n.hasOwnProperty(r)&&"function"==typeof n[r]&&(e[r]=function(e){return function(){return r=n[e].apply(this,Array.prototype.slice.call(arguments)),t=o.defer(),r.then(function(e){if(!e)return t.reject("未收到服务器数据");(e=e.data).isSuccess?""===e.result||0===e.result||!1===e.result?t.resolve(e.result):t.resolve(e.result||e.results):(console.error(e),console.error(r.value),void 0!==e.code?(t.reject(e),"302"===String(e.code)&&(window.location.href=e.message)):t.reject(e.message||"服务器返回错误的数据"))},function(e){e=e?e.data:"未收到服务器数据",t.reject(e),e&&e.code&&"401"===String(e.code)&&"/sign-in"!==window.location.pathname&&(window.location.href="/sign-in?return_url="+encodeURIComponent(window.location.href))}),t.promise;var r,t}}(r));return e.executePromiseAvoidDuplicate=function(e,r,t){var n=o.defer();return e[r]?(n.reject("submitting..."),n):(e[r]=!0,t().finally(function(){e[r]=!1}))},e.postSync=function(e){var r=new Worker(mydir+"syncRequest.js");r.onmessage=function(e){console.log(e),alert(e.data)},r.postMessage("POST")},e}]);